(()=>{"use strict";var n,e,t={d:(n,e)=>{for(var a in e)t.o(e,a)&&!t.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:e[a]})},o:(n,e)=>Object.prototype.hasOwnProperty.call(n,e)};t.d({},{o:()=>p}),function(n){n.INIT_EXPORT="INIT_EXPORT",n.INIT_TRANSLATE="INIT_TRANSLATE",n.RESULT_TRANSLATE="RESULT_TRANSLATE"}(n||(n={})),function(n){n.START_EXPORT="START_EXPORT",n.START_TRANSLATE="START_TRANSLATE",n.PROGRESS_TRANSLATE="PROGRESS_TRANSLATE",n.PROGRESS_EXPORT="PROGRESS_EXPORT"}(e||(e={}));const a={en:"English",ar:"Arabic",hu:"Hungarian",vi:"Vietnamese",el:"Greek",da:"Danish",iw:"Hebrew",id:"Indonesian",es:"Spanish",it:"Italian",ca:"Catalan",zh:"Chinese",ko:"Korean",ms:"Malay",de:"German",nl:"Dutch",no:"Norwegian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sk:"Slovak",th:"Thai",tr:"Turkish",uk:"Ukrainian",fi:"Finnish",fr:"French",hi:"Hindi",hr:"Croatian",cs:"Czech",sv:"Swedish",ja:"Japanese"},o=Object.assign(Object.assign({},a),{is:"Icelandic",lv:"Latvian",lt:"Lithuanian",sl:"Slovenian",et:"Estonian"}),i={JPG:a,PNG:o},r={JPG:"ios",PNG:"android"};const c=["FRAME"],s=["TEXT","FRAME"];function l(n){const e="children"in n?n.children[0]:null;return e||console.error(`getTextNode(${JSON.stringify(n)}): Your frame is empty!`),e&&"TEXT"===e.type?e:l(e)}function u(n){return n.filter((n=>s.includes(n.type))).map((n=>c.includes(n.type)?l(n):n))}function h(n){var e;return"PAGE"===(null===(e=n.parent)||void 0===e?void 0:e.type)?n:h(n.parent)}function p({type:n,payload:e}){figma.ui.postMessage({type:n,payload:e})}figma.showUI(__html__,{width:300,height:158,visible:!0});const d=[],f=[];function T(){figma.ui.hide();const n=d.length,t=figma.currentPage.selection;f.push(t.find((n=>h(n))));const a=u(t);console.log("Prepare-Text",a);const i=a.map((n=>({parent:h(n.parent),text:n})));console.log("Prepare-Parent",i);const r=i.reduce(((n,e)=>{const t=n.find((n=>n.parent.id===e.parent.id));return t?t.texts.push(e.text):n.push({parent:e.parent,texts:[e.text]}),n}),[]);console.log("Prepare-Groupped",r),function(n,t){const a=Object.keys(o),i=t+n.length*a.length;console.log(t,n.length,a.length),n.forEach((n=>{const t=n.texts.map((n=>n.characters)),o=t.join("*");a.forEach((t=>{p({type:e.START_TRANSLATE,payload:{language:t,text:o,node:n,count:i}})}))}))}(r,n)}T(),figma.ui.onmessage=function({type:t,payload:a}){if(t===n.INIT_EXPORT){const n=figma.currentPage.selection.map((n=>h(n))).map((n=>n.id));(function(n,t){return a=this,o=void 0,c=function*(){console.log("Exporting: ",n,t);const a={constraint:{type:"SCALE",value:1},contentsOnly:!0,suffix:"",format:t},o=r[t],i=n.map((({frame:i,language:r},c)=>i.exportAsync(a).then((a=>{const s=i.name.replace("/",""),l={frameId:i.id,format:t.toLowerCase(),name:s,path:`${o}/${r}/`,bytes:a};return p({type:e.PROGRESS_EXPORT,payload:{index:c+1,count:n.length}}),l})))),c=yield Promise.all(i);return p({type:e.PROGRESS_EXPORT,payload:{index:n.length,count:n.length}}),c},new((i=void 0)||(i=Promise))((function(n,e){function t(n){try{s(c.next(n))}catch(n){e(n)}}function r(n){try{s(c.throw(n))}catch(n){e(n)}}function s(e){var a;e.done?n(e.value):(a=e.value,a instanceof i?a:new i((function(n){n(a)}))).then(t,r)}s((c=c.apply(a,o||[])).next())}));var a,o,i,c})((n.length>0?d.filter((e=>n.includes(e.frame.id))):d).filter((n=>{if(Object.keys(i[a]).includes(n.language))return n})),a).then((n=>{console.log("Finished-Export:",n),p({type:e.START_EXPORT,payload:n})}))}t===n.INIT_TRANSLATE&&T(),t===n.RESULT_TRANSLATE&&function(n,e,t,a){var i,r,c,s,l;return r=this,c=void 0,l=function*(){const r=Object.keys(o),c=a.split("*"),s=null===(i=n.parent)||void 0===i?void 0:i.id,l=figma.currentPage.findOne((n=>n.id===s));if(!l)throw new Error(`Frame with ID ${s} not found`);const u=l.clone(),h=r.indexOf(t)+1;u.y+=u.height*h+200*h,u.name=`${o[t]} - ${l.name}`;const p=u.findAll((n=>"TEXT"===n.type)).filter((n=>{const t=n;if(e.includes(t.characters))return t})).map(((n,e)=>{const t=c[e],a=n;return figma.loadFontAsync(a.fontName).then((()=>{a.characters=t}))}));return yield Promise.all(p),{frame:u,language:t}},new((s=void 0)||(s=Promise))((function(n,e){function t(n){try{o(l.next(n))}catch(n){e(n)}}function a(n){try{o(l.throw(n))}catch(n){e(n)}}function o(e){var o;e.done?n(e.value):(o=e.value,o instanceof s?o:new s((function(n){n(o)}))).then(t,a)}o((l=l.apply(r,c||[])).next())}))}(a.node,a.original,a.language,a.text).then((n=>{d.push(n),d.length===a.count&&(console.log("Ready",d),figma.ui.show()),p({type:e.PROGRESS_TRANSLATE,payload:{translated:d.length,all:a.count}})}))}})();